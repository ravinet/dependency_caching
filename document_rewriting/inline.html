<script>
   function get_caller(caller){
       var script_attributes = "";
       if ( caller == null ) {
           longname = window.location.pathname;
           if ( longname == "/" ) {
               script_attributes = "/";
           } else {
               script_attributes = longname.split('/').pop();
           }
           if ( script_attributes == "" ) {
               script_attributes = "event_handler_or_callback";
           }
       } else {
           var attr = caller.attributes;
           if( attr.length == 0 ) {
               longname = window.location.pathname;
               if ( longname == "/" ) {
                   script_attributes = "/";
               } else {
                   script_attributes = longname.split('/').pop();
               }
               if ( script_attributes == "" ) {
                   script_attributes = "inline_script";
               }
           } else {
               for(j=0; j < attr.length; j++) {
                   if( attr[j].name == "src" ) {
                       script_attributes = script_attributes.concat( attr[j].value );
                   }
                   if ( script_attributes == "" ) {
                       script_attributes = window.location.pathname;
                   }
               }
           }
       }
       return script_attributes;
   }

   function list_properties(properties){
       var props = "";
       for (var key in properties){
           props = props.concat(key + ":" + properties[key] + ", ");
       }
       props = props.slice(0, props.length-2);
       return props;
   }

   function list_properties_array(properties){
       var props = "";
       for (j = 0; j < properties.length; j++){
           var arr = properties[j];
           for (i = 0; i < arr.length; i++){
               props = props.concat(arr[i] + ", ");
           }
           props = props.slice(0, props.length-2);
           props = props + ";";
       }
       props = props.slice(0, props.length-1);
       return props;
   }

   function print_single_attr(child_attributes){
       var final_attributes = "";
       for (y=0; y<child_attributes.length; y++){
           final_attributes = final_attributes.concat(child_attributes[y] + "; ");
       }
       final_attributes = final_attributes.slice(0, final_attributes.length-2);
       return final_attributes;
   }

   function print_multiple_attr(child_attributes){
       var final_attributes = "";
       for (var key in child_attributes){
           final_attributes = final_attributes.concat(key + "-");
           var current_attributes = child_attributes[key];
           for (y=0; y<current_attributes.length; y++){
               final_attributes = final_attributes.concat(current_attributes[y] + "; ");
           }
       }
       final_attributes = final_attributes.slice(0, final_attributes.length-2);
       return final_attributes;
   }

   function print_nodes(parents){
       var nodes = "";
       for (var key in parents) {
           nodes = nodes.concat(key +",");
       }
       nodes = nodes.slice(0, nodes.length-1);
       return nodes;
   }

   function get_child_path(curr){
       child_path = [];
       child_path_tags = [];
       while ( curr.parentNode != null ) {
          var children = curr.parentNode.children;
          for (j = 0; j < children.length; j++){
              if( children[j] == curr ){
                  child_path.push(j);
                  child_path_tags.push(children[j].tagName);
              }
          }
          curr = curr.parentNode;
       }
       return [child_path, child_path_tags];
   }

   function get_multi_child_path(retVal){
       curr = retVal;
       parents = {};
       child_paths = {};
       child_paths_no_id = [];
       child_path_tags_no_id = [];
       child_path_tags = {};
       child_path_attr = {};
       for (i = 0; i < retVal.length; i++) {
           curr_child_path = [];
           curr_child_path_tags = [];
           curr_parents = [];
           curr_child_path_attr = [];
           curr = retVal[i];
           while ( curr.parentNode != null ) {
               curr_parents.push(curr.parentNode.id);
               var children = curr.parentNode.children;
               for (j = 0; j < children.length; j++){
                   if( children[j] == curr ){
                       curr_child_path.push(j);
                       curr_child_path_tags.push(children[j].tagName);
                       var attr = children[j].attributes;
                       var attributes = [];
                       for( a=0; a<attr.length; a++){
                           attributes.push(attr[a].name + ":" + attr[a].value);
                       }
                       curr_child_path_attr.push(attributes);
                   }
               }
               curr = curr.parentNode;
           }
           parents[retVal[i].id] = curr_parents;
           child_paths[retVal[i].id] = curr_child_path;
           child_paths_no_id.push(curr_child_path);
           child_path_tags[retVal[i].id] = curr_child_path_tags;
           child_path_tags_no_id.push(curr_child_path_tags);
           child_path_attr[retVal[i].id] = curr_child_path_attr;
       }
       ret = [child_paths_no_id, child_path_tags_no_id];
       return ret;
   }


   var _appendChild = Node.prototype.appendChild;
   Node.prototype.appendChild = function(child){
                                    var retVal = _appendChild.call(this, child);
                                    var caller = get_caller(document.currentScript);
                                    child_vals = get_child_path(this);
                                    console.log( "Call to Node.prototype.appendChild() in " + caller + "; arg=" + child +
                                                 "=" + child.id + "; node_modified=" + this.id + ": child_path=" +
                                                 child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                    return retVal;
                                };

   var _removeChild = Node.prototype.removeChild;
   Node.prototype.removeChild = function(child){
                                    var retVal = _removeChild.call(this, child);
                                    var caller = get_caller(document.currentScript);
                                    child_vals = get_child_path(this);
                                    console.log( "Call to Node.prototype.removeChild() in " + caller + "; arg="+ child +
                                                 "=" + child.id + "; node_modified=" + this.id + ": child_path=" +
                                                 child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                    return retVal;
                                };

   var _replaceChild = Node.prototype.replaceChild;
   Node.prototype.replaceChild = function(newchild, oldchild){
                                    var retVal = _replaceChild.call(this, newchild, oldchild);
                                    var caller = get_caller(document.currentScript);
                                    child_vals = get_child_path(this);
                                    console.log( "Call to Node.prototype.replaceChild() in " + caller + "; args="+ newchild +
                                                 "," + oldchild + "=" + newchild.id + "," + oldchild.id + "; node_modified=" +
                                                 this.id + ": child_path=" + child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                    return retVal;
                                };

   var _insertBefore = Node.prototype.insertBefore;
   Node.prototype.insertBefore = function(newchild, referencechild){
                                    if (referencechild == undefined) { referencechild = null; }
                                    var retVal = _insertBefore.call(this, newchild, referencechild);
                                    var caller = get_caller(document.currentScript);
                                    child_vals = get_child_path(this);
                                    if ( referencechild == null ) {
                                        console.log( "Call to Node.prototype.insertBefore() in " + caller + "; args="+ newchild +
                                        "," + referencechild + "=" + newchild.id + ",null; node_modified=" +
                                        this.id + ": child_path=" + child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                        return retVal;
                                    }
                                    console.log( "Call to Node.prototype.insertBefore() in " + caller + "; args="+ newchild +
                                                 "," + referencechild + "=" + newchild.id + "," + referencechild.id + "; node_modified=" +
                                                 this.id + ": child_path=" + child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                    return retVal;
                                };

   var _getElementById = document.getElementById;
   document.getElementById = function(requested_id){
                                 // log the method name, argument (id name), returned node child path
                                 var retVal = _getElementById.call(this, requested_id);
                                 var caller = get_caller(document.currentScript);
                                 child_vals = get_child_path(retVal);
                                 console.log( "Call to document.getElementById() in " + caller + "; args="+ requested_id  +
                                 "; returned_node_child_path=" + child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                 return retVal;
                             };


   var _querySelector = document.querySelector;
   document.querySelector = function(requested_selectors){
                                 // log the method name, argument (selectors), returned node child path
                                 var retVal = _querySelector.call(this, requested_selectors);
                                 var caller = get_caller(document.currentScript);
                                 child_vals = get_child_path(retVal);
                                 console.log( "Call to document.querySelector() in " + caller + "; args="+ requested_selectors  +
                                 "; returned_node_child_path=" + child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                 return retVal;
                             };

   var _elementFromPoint = document.elementFromPoint;
   document.elementFromPoint = function(requested_point1, requested_point2){
                                 // log the method name, argument (id name), returned node child path
                                 var retVal = _elementFromPoint.call(this, requested_point1, requested_point2);
                                 var caller = get_caller(document.currentScript);
                                 child_vals = get_child_path(retVal);
                                 console.log( "Call to document.elementFromPoint() in " + caller + "; args="+ requested_point1 +
                                 "," + requested_point2 + "; returned_node_child_path=" + child_vals[0] + "; child_path_tags=" + child_vals[1]);
                                 return retVal;
                             };


   var _getElementsByName = document.getElementsByName;
   document.getElementsByName = function(requested_name){
                                 // log the method name, argument (name), returned list of children (path for each)
                                 var retVal = _getElementsByName.call(this, requested_name);
                                 var caller = get_caller(document.currentScript);
                                 var ret = get_multi_child_path(retVal);
                                 console.log( "Call to document.getElementsByName() in " + caller + "; args=" + requested_name +
                                 "; returned_nodes_child_paths=" + list_properties_array(ret[0]) + "; child_path_tags=" + list_properties_array(ret[1]));
                                 return retVal;
                             };

   var _getElementsByClassName = document.getElementsByClassName;
   document.getElementsByClassName = function(requested_class){
                                 // log the method name, argument (class name), returned list of children (path for each)
                                 var retVal = _getElementsByClassName.call(this, requested_class);
                                 var caller = get_caller(document.currentScript);
                                 var ret = get_multi_child_path(retVal);
                                 console.log( "Call to document.getElementsByClassName() in " + caller + "; args=" + requested_class +
                                 "; returned_nodes_child_paths=" + list_properties_array(ret[0]) + "; child_path_tags=" + list_properties_array(ret[1]));
                                 return retVal;
                             };


   var _getElementsByTagName = document.getElementsByTagName;
   document.getElementsByTagName = function(requested_tag){
                                 // log the method name, argument (tag name), returned list of children (path for each)
                                 var retVal = _getElementsByTagName.call(this, requested_tag);
                                 var caller = get_caller(document.currentScript);
                                 var ret = get_multi_child_path(retVal);
                                 console.log( "Call to document.getElementsByTagName() in " + caller + "; args=" + requested_tag +
                                 "; returned_nodes_child_paths=" + list_properties_array(ret[0]) + "; child_path_tags=" + list_properties_array(ret[1]));
                                 return retVal;
                             };

   var _querySelectorAll = document.querySelectorAll;
   document.querySelectorAll = function(requested_selector){
                                 // log the method name, argument (selector name), returned list of children (path for each)
                                 // returns the nodes in top-to-bottom order (any match)---not in order of selectors
                                 var retVal = _querySelectorAll.call(this, requested_selector);
                                 var caller = get_caller(document.currentScript);
                                 var ret = get_multi_child_path(retVal);
                                 console.log( "Call to document.querySelectorAll() in " + caller + "; args=" + requested_selector +
                                 "; returned_nodes_child_paths=" + list_properties_array(ret[0]) + "; child_path_tags=" + list_properties_array(ret[1]));
                                 return retVal;
                             };

   var _getElementsByTagNameNS = document.getElementsByTagNameNS;
   document.getElementsByTagNameNS = function(namespace, requested_tag){
                                 // log the method name, argument (selector tag), returned list of children (path for each)
                                 var retVal = _querySelectorAll.call(this, namespace, requested_tag);
                                 var caller = get_caller(document.currentScript);
                                 var ret = get_multi_child_path(retVal);
                                 console.log( "Call to document.getElementsByTagNameNS() in " + caller + "; args=" + namespace + "," + requested_tag +
                                 "; returned_nodes_child_paths=" + list_properties_array(ret[0]) + "; child_path_tags=" + list_properties_array(ret[1]));
                                 return retVal;
                             };
</script>
