<html>
<head>
<script src="~/node_modules/esprima/esprima.js"></script>
<script src="escodegen.browser.js"></script>
<!--<script src="estraverse.js"></script>-->
<script>
function addnop(esprima_tree, code_string)
{
  var length = esprima_tree.body.length;
  var random_index = Math.floor(Math.random() * length);
  esprima_tree.body.splice(random_index, 0, esprima.parse(code_string));  
}
function lit_to_exp(node, value){
  node.type = "BinaryExpression";
  node.operator = "+";
  left_value = Math.round(Math.random() * value);
  right_value = value - left_value;
  if (left_value < 0 || right_value < 0)
    return;
  node.left = {"type" : "Literal",
               "value" : left_value,
               "raw" : String(left_value) };
  node.right = {"type" : "Literal",
                "value" : right_value,
                "raw" : String(right_value)};
  node.right = esprima.parse("(function() {return 7;}());").body[0].expression;
  console.log('hi');
}

function lit_to_func(node, value) {
  node.type = "BinaryExpression";
  node.operator = "+";
  left_value = Math.round(Math.random() * value);
  right_value = value - left_value;
  if (left_value < 0 || right_value < 0)
    return;
  node.left = {"type" : "Literal",
               "value" : left_value,
               "raw" : String(left_value) };
  node.right = esprima.parse("(function() {return " + String(right_value) + ";}());").body[0].expression;
}

function clone(obj) {
    if (null == obj || "object" != typeof obj) return obj;
    var copy = obj.constructor();
    for (var attr in obj) {
        if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
    }
    return copy;
}
// node is the location of the block statement that you want to nest
function nest_in_if(node)
{
  var temp = clone(node);
  node.body = [ { "type" : "IfStatement", "test": { "type" : "Literal", "value" : true, "raw" : "true"}, "consequent" : temp}];
}

function makeid(length)
{
    var text = "";
    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

    for( var i=0; i < length; i++ ) {
      text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return text;
}

function make_random_var()
{
  var length1 = Math.floor(Math.random() * 10) + 1;
  var length2 = Math.floor(Math.random() * 10) + 1;
  var var_name = makeid(length1);
  obs_str = "var " + var_name + " = \"" + makeid(length2) + "\";";
  return { name: var_name,
           random_var: obs_str};
}

//nest_in_if(syntax.body[1].body);
//addnop(syntax, 'function randomFunction() { return null;}');
</script>
</head>
<form id="stuff">
<textarea rows="50" cols="75" name="original_js" id="originaljs"></textarea>  
<textarea rows="50" cols="75" id="newjs"></textarea> <br/>
<button type="button" name="submit" id="submitButton">Go!</button>
</form>
<script>
  submitButton.addEventListener("click",
                                 function() {
                                   var input = document.getElementById("originaljs").value;
                                   //document.getElementById('newjs').value = "working";
								   console.log(input);
                                   document.getElementById('newjs').value = escodegen.generate(input); 
                             });
</script>
</html>
